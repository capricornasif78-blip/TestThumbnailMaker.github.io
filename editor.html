<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Test Maker — Editor</title>
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='20' fill='%23007AFF'/%3E%3Ctext x='50' y='58' font-size='44' text-anchor='middle' fill='white' font-family='Segoe UI, Roboto, Arial'%3ET%3C/text%3E%3C/svg%3E">
<style>
:root{--accent1:#00c6ff;--accent2:#0072ff;--muted:#6b7280}
*{box-sizing:border-box}
body{font-family:Inter,system-ui,Arial;margin:0;background:linear-gradient(180deg,#f7fbff,#f1f7ff);color:#072036}
.container{max-width:1200px;margin:22px auto;padding:0 18px}
header{display:flex;justify-content:space-between;align-items:center;padding:12px 0}
.brand{display:flex;gap:12px;align-items:center}
.mark{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent1),var(--accent2));display:grid;place-items:center;color:white;font-weight:800}
nav a{margin-left:14px;color:#072036;text-decoration:none;font-weight:600}
.layout{display:grid;grid-template-columns:1fr 380px;gap:18px;align-items:start}
.card{background:white;border-radius:12px;padding:16px;box-shadow:0 8px 26px rgba(10,30,50,.06)}
.canvas-wrap{border-radius:10px;border:1px dashed #e2efff;min-height:420px;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,#fff,#f3fbff)}
.tools{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
.input,select,textarea{padding:8px;border-radius:8px;border:1px solid #e6eefc}
.btn{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:white;padding:10px 14px;border-radius:10px;border:0;font-weight:700;cursor:pointer}
.small{font-size:13px;color:var(--muted)}
.layer-list{margin-top:12px;max-height:180px;overflow:auto}
.layer-item{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;border:1px solid #f0f6ff;margin-bottom:8px;background:#fbfdff;cursor:default}
.gallery{display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:8px;margin-top:10px}
.thumb{height:72px;border-radius:8px;display:flex;align-items:flex-end;padding:8px;color:white;font-weight:700;cursor:pointer;overflow:hidden;position:relative}
.footer{margin-top:18px;padding:16px;border-radius:10px;background:#081025;color:#dbe9ff}
@media(max-width:980px){.layout{grid-template-columns:1fr} nav a{display:none}}
</style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="mark">T</div>
        <div>
          <div style="font-weight:800">Test Maker</div>
          <div class="small">Online thumbnail maker</div>
        </div>
      </div>
      <nav>
        <a href="index.html">Home</a>
        <a href="templates.html">Templates</a>
        <a href="pricing.html">Pricing</a>
        <a href="faq.html">FAQ</a>
        <a href="contact.html">Contact</a>
        <a href="about.html">About</a>
      </nav>
    </header>

    <main class="layout">
      <section>
        <div class="card">
          <h2 style="margin:0 0 8px">Thumbnail Editor</h2>
          <div class="small">Upload an image, add multiple text layers, drag to position, and download PNG.</div>

          <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
            <label class="input" style="cursor:pointer">
              Upload Image
              <input type="file" id="uploadInput" accept="image/*" style="display:none">
            </label>
            <button class="input" id="insertSample">Insert Sample</button>
            <button class="input" id="clearAll">Clear All</button>
            <button class="btn" id="downloadBtn">Download PNG</button>
          </div>

          <div style="margin-top:12px" class="canvas-wrap" id="canvasWrap">
            <canvas id="editorCanvas" width="1280" height="720" style="max-width:100%;height:auto;border-radius:8px"></canvas>
          </div>

          <div class="tools">
            <input id="textInput" class="input" placeholder="Add headline text">
            <input type="color" id="textColor" value="#ffffff">
            <input type="range" id="fontSize" min="20" max="160" value="64">
            <select id="fontSelect" class="input">
              <option>Impact</option><option>Arial</option><option>Verdana</option><option>Roboto</option>
            </select>
            <button class="btn" id="addText">Add Text Layer</button>
          </div>

          <div class="small" style="margin-top:8px">Tip: Click a text layer in the canvas to select and drag it. Use the layer list to reorder or delete layers.</div>

          <div class="layer-list" id="layerList"></div>
        </div>

        <div style="margin-top:14px" class="card">
          <h3 style="margin:0 0 8px">Quick Actions</h3>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button class="input" id="flipH">Flip Horizontal</button>
            <button class="input" id="flipV">Flip Vertical</button>
            <button class="input" id="bgWhite">White BG</button>
            <button class="input" id="bgTransparent">Transparent BG</button>
          </div>
        </div>
      </section>

      <aside>
        <div class="card">
          <h3 style="margin:0 0 8px">Templates</h3>
          <div class="gallery" id="templateGallery"></div>
          <a href="templates.html" class="small" style="text-decoration:none;display:inline-block;margin-top:10px">Open full templates page →</a>
        </div>

        <div class="card" style="margin-top:12px">
          <h3 style="margin:0 0 8px">Layers</h3>
          <div class="small">Manage your layers below</div>
          <div id="layersPanel" style="margin-top:8px"></div>
        </div>

        <div class="card" style="margin-top:12px">
          <h3 style="margin:0 0 8px">Export Settings</h3>
          <div class="small">Canvas resolution</div>
          <select id="resSelect" class="input" style="margin-top:8px">
            <option value="1280x720">1280 × 720 (YouTube)</option>
            <option value="1920x1080">1920 × 1080 (HD)</option>
            <option value="640x360">640 × 360 (Small)</option>
          </select>
          <div style="margin-top:8px" class="small">Filename</div>
          <input id="fileName" class="input" placeholder="thumbnail.png" value="test-maker-thumbnail.png" style="margin-top:6px">
        </div>
      </aside>
    </main>

    <footer class="footer">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <strong>Test Maker</strong> <div class="small">Create thumbnails fast — made by creators.</div>
        </div>
        <div class="small">© <span id="year"></span> Test Maker</div>
      </div>
    </footer>
  </div>

<script>
/* Editor JS: layers, upload, templates, drag, download, reorder */
const canvas = document.getElementById('editorCanvas');
const ctx = canvas.getContext('2d');
const uploadInput = document.getElementById('uploadInput');
const textInput = document.getElementById('textInput');
const textColor = document.getElementById('textColor');
const fontSize = document.getElementById('fontSize');
const fontSelect = document.getElementById('fontSelect');
const addTextBtn = document.getElementById('addText');
const downloadBtn = document.getElementById('downloadBtn');
const templateGallery = document.getElementById('templateGallery');
const layerList = document.getElementById('layerList');
const layersPanel = document.getElementById('layersPanel');
const resSelect = document.getElementById('resSelect');
const fileNameInput = document.getElementById('fileName');
const yearElem = document.getElementById('year');
yearElem.innerText = new Date().getFullYear();

let layers = []; // each: {id,type:'image'|'text'|'rect', ...}
let selected = null;
let dragOffset = {x:0,y:0};
let isDown = false;

function setCanvasSize(w,h){
  canvas.width = w; canvas.height = h;
}
setCanvasSize(1280,720);

function render(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  // default transparent background: draw white if bgWhite active
  const bgRect = layers.find(l=>l.type==='rect' && l.isBg);
  if(bgRect){ ctx.fillStyle = bgRect.color; ctx.fillRect(0,0,canvas.width,canvas.height); }

  // images first
  layers.filter(l=>l.type==='image').forEach(l=>{
    if(!l.img) return;
    const iw = l.img.width, ih = l.img.height;
    // draw with fit or custom transform
    const scale = l.scale || Math.max(canvas.width/iw, canvas.height/ih);
    const dw = iw * scale, dh = ih * scale;
    const dx = (canvas.width - dw)/2 + (l.offsetX||0);
    const dy = (canvas.height - dh)/2 + (l.offsetY||0);
    ctx.drawImage(l.img, dx, dy, dw, dh);
  });

  // rects (non-bg) covering full canvas
  layers.filter(l=>l.type==='rect' && !l.isBg).forEach(l=>{
    ctx.fillStyle = l.color; ctx.fillRect(0,0,canvas.width,canvas.height);
  });

  // text
  layers.filter(l=>l.type==='text').forEach(l=>{
    ctx.font = `${l.size}px ${l.font}`;
    ctx.textBaseline = 'top';
    ctx.fillStyle = l.color;
    ctx.lineWidth = Math.max(2, Math.floor(l.size/18));
    ctx.strokeStyle = 'rgba(0,0,0,0.35)';
    ctx.strokeText(l.text, l.x, l.y);
    ctx.fillText(l.text, l.x, l.y);
    if(selected && selected.id === l.id){
      const metrics = ctx.measureText(l.text);
      const w = metrics.width; const h = l.size;
      ctx.strokeStyle = 'rgba(0,114,255,0.9)'; ctx.lineWidth = 2;
      ctx.strokeRect(l.x-6, l.y-6, w+12, h+12);
    }
  });
  updateLayerPanels();
}

function addLayer(l){
  layers.push(l); render();
}
function uid(){ return 'id'+Math.random().toString(36).slice(2,9); }

// Templates
const templateDefs = [
  {name:'YouTube Bold', bg:'#ff4757', text:'Make It Viral'},
  {name:'Gaming Epic', bg:'#1e90ff', text:'EPIC WIN'},
  {name:'Tutorial Clean', bg:'#00d084', text:'How to do it'},
  {name:'Business Pro', bg:'#8b5cf6', text:'Top Tips'},
  {name:'Cinematic Dark', bg:'#0b1220', text:'New Video'},
];
function buildTemplates(){
  templateGallery.innerHTML = '';
  templateDefs.forEach((t)=>{
    const d = document.createElement('div');
    d.className='thumb';
    d.style.background = `linear-gradient(180deg,${t.bg},#00000030)`;
    d.innerHTML = `<div style="padding:8px"><small>${t.name}</small><div style="font-weight:800;margin-top:6px">${t.text}</div></div>`;
    d.addEventListener('click', ()=>{
      // apply template: bg rect + sample text
      layers = [];
      layers.push({id:uid(), type:'rect', isBg:true, color: t.bg});
      layers.push({id:uid(), type:'text', text: t.text, font:'Impact', size:88, color:'#fff', x:80, y:240});
      render();
    });
    templateGallery.appendChild(d);
  });
}

// Upload image
uploadInput.addEventListener('change', (e)=>{
  const f = e.target.files[0]; if(!f) return;
  const img = new Image();
  img.onload = ()=>{
    const l = {id:uid(), type:'image', img, scale: Math.max(canvas.width/img.width, canvas.height/img.height), offsetX:0, offsetY:0};
    // put image behind texts - unshift to beginning
    layers = [l, ...layers.filter(x=>x.type!=='image')];
    render();
  };
  img.src = URL.createObjectURL(f);
});

// Insert sample image (data-generated colored placeholder)
document.getElementById('insertSample').addEventListener('click', ()=>{
  // create a temp colored image using canvas
  const tcanvas = document.createElement('canvas'); tcanvas.width=1200; tcanvas.height=675;
  const tc = tcanvas.getContext('2d');
  tc.fillStyle = '#111827'; tc.fillRect(0,0,tcanvas.width,tcanvas.height);
  tc.fillStyle = '#ffb86b'; tc.font='bold 80px Impact'; tc.fillText('Sample Image',80,320);
  const img = new Image(); img.onload = ()=>{
    layers = [{id:uid(), type:'image', img, scale: Math.max(canvas.width/img.width, canvas.height/img.height), offsetX:0, offsetY:0}, ...layers.filter(x=>x.type!=='image')];
    render();
  };
  img.src = tcanvas.toDataURL();
});

// Add text
addTextBtn.addEventListener('click', ()=>{
  const txt = textInput.value.trim(); if(!txt) return alert('Enter text first');
  const l = {id:uid(), type:'text', text:txt, font: fontSelect.value||'Impact', size: parseInt(fontSize.value,10)||64, color: textColor.value||'#fff', x:80, y:80 + (layers.filter(x=>x.type==='text').length*72)};
  addLayer(l);
  textInput.value='';
});

// Clear all
document.getElementById('clearAll').addEventListener('click', ()=>{
  if(!confirm('Clear all layers?')) return;
  layers = [];
  render();
});

// Download
downloadBtn.addEventListener('click', ()=>{
  // set canvas resolution from select
  const [w,h] = resSelect.value.split('x').map(n=>parseInt(n,10));
  // create export canvas
  const exportCanvas = document.createElement('canvas');
  exportCanvas.width = w; exportCanvas.height = h;
  const ectx = exportCanvas.getContext('2d');
  // background
  const bg = layers.find(l=>l.type==='rect' && l.isBg);
  if(bg) { ectx.fillStyle = bg.color; ectx.fillRect(0,0,w,h); } else { ectx.fillStyle = '#ffffff'; ectx.fillRect(0,0,w,h); }
  // draw images first
  layers.filter(l=>l.type==='image').forEach(l=>{
    const img = l.img;
    const scale = Math.max(w/img.width, h/img.height);
    const dw = img.width * scale, dh = img.height * scale;
    const dx = (w-dw)/2 + (l.offsetX||0) * (w/canvas.width);
    const dy = (h-dh)/2 + (l.offsetY||0) * (h/canvas.height);
    ectx.drawImage(img, dx, dy, dw, dh);
  });
  // draw rects
  layers.filter(l=>l.type==='rect' && !l.isBg).forEach(l=>{
    ectx.fillStyle = l.color; ectx.fillRect(0,0,w,h);
  });
  // draw texts
  layers.filter(l=>l.type==='text').forEach(l=>{
    const scale = w / canvas.width;
    ectx.font = `${Math.round(l.size*scale)}px ${l.font}`;
    ectx.textBaseline = 'top';
    ectx.lineWidth = Math.max(2, Math.floor((l.size*scale)/18));
    ectx.strokeStyle = 'rgba(0,0,0,0.35)';
    ectx.fillStyle = l.color;
    ectx.strokeText(l.text, Math.round(l.x*scale), Math.round(l.y*(h/canvas.height)));
    ectx.fillText(l.text, Math.round(l.x*scale), Math.round(l.y*(h/canvas.height)));
  });
  const a = document.createElement('a');
  a.href = exportCanvas.toDataURL('image/png');
  a.download = fileNameInput.value || 'thumbnail.png';
  a.click();
});

// Layer panels + reorder + delete
function updateLayerPanels(){
  // simple layer list (top = first in array)
  layersPanel.innerHTML = '';
  for(let i=layers.length-1;i>=0;i--){
    const l = layers[i];
    const div = document.createElement('div'); div.className='layer-item';
    div.innerHTML = `<div style="font-weight:700">${l.type.toUpperCase()}</div><div style="display:flex;gap:6px;align-items:center"><button data-id="${l.id}" class="moveUp">Up</button><button data-id="${l.id}" class="moveDown">Down</button><button data-id="${l.id}" class="del">Delete</button></div>`;
    layersPanel.appendChild(div);
  }
  // attach events
  document.querySelectorAll('.moveUp').forEach(b=>{
    b.onclick = ()=>{ const id=b.dataset.id; const idx = layers.findIndex(x=>x.id===id); if(idx>0){ const tmp = layers[idx]; layers.splice(idx,1); layers.splice(idx-1,0,tmp); render(); } };
  });
  document.querySelectorAll('.moveDown').forEach(b=>{
    b.onclick = ()=>{ const id=b.dataset.id; const idx = layers.findIndex(x=>x.id===id); if(idx<layers.length-1){ const tmp = layers[idx]; layers.splice(idx,1); layers.splice(idx+1,0,tmp); render(); } };
  });
  document.querySelectorAll('.del').forEach(b=>{
    b.onclick = ()=>{ const id=b.dataset.id; layers = layers.filter(x=>x.id!==id); render(); };
  });
}

// Simple hit test for text layers
function hitTest(x,y){
  for(let i=layers.length-1;i>=0;i--){
    const l = layers[i];
    if(l.type==='text'){
      ctx.font = `${l.size}px ${l.font}`;
      const metrics = ctx.measureText(l.text);
      const w = metrics.width; const h = l.size;
      if(x >= l.x-8 && x <= l.x + w + 8 && y >= l.y-8 && y <= l.y + h + 8) return l;
    }
    if(l.type==='image'){
      // select image if clicked anywhere (simple)
      return l;
    }
  }
  return null;
}

// pointer events for dragging layers
function getPos(evt){
  const r = canvas.getBoundingClientRect();
  const clientX = evt.touches ? evt.touches[0].clientX : evt.clientX;
  const clientY = evt.touches ? evt.touches[0].clientY : evt.clientY;
  const x = (clientX - r.left) * (canvas.width / r.width);
  const y = (clientY - r.top) * (canvas.height / r.height);
  return {x,y};
}

canvas.addEventListener('pointerdown', (e)=>{
  const p = getPos(e);
  const hit = hitTest(p.x,p.y);
  if(hit){
    selected = hit;
    dragOffset.x = p.x - (hit.x||0);
    dragOffset.y = p.y - (hit.y||0);
    isDown = true;
    render();
  } else {
    selected = null; render();
  }
});
window.addEventListener('pointermove', (e)=>{
  if(!isDown || !selected) return;
  const p = getPos(e);
  if(selected.type==='text'){
    selected.x = p.x - dragOffset.x;
    selected.y = p.y - dragOffset.y;
  } else if(selected.type==='image'){
    // adjust image offset relative to center
    selected.offsetX = (p.x - canvas.width/2);
    selected.offsetY = (p.y - canvas.height/2);
  }
  render();
});
window.addEventListener('pointerup', ()=>{ isDown=false; });

// quick actions
document.getElementById('flipH').addEventListener('click', ()=> {
  // mirror images by toggling scale negative
  layers.filter(l=>l.type==='image').forEach(l=> l.flippedH = !l.flippedH);
  // (for demo we won't implement real flip, just alert)
  alert('Flip action is demo-only in this build. Use image editor for precise flips.');
});
document.getElementById('flipV').addEventListener('click', ()=> alert('Flip Vertical is demo-only.'));
document.getElementById('bgWhite').addEventListener('click', ()=> { layers = layers.filter(l=>!(l.type==='rect' && l.isBg)); layers.unshift({id:uid(), type:'rect', isBg:true, color:'#ffffff'}); render(); });
document.getElementById('bgTransparent').addEventListener('click', ()=> { layers = layers.filter(l=>!(l.type==='rect' && l.isBg)); render(); });

// load template via localStorage (from templates.html)
(function loadSelectedTemplate(){
  try{
    const raw = localStorage.getItem('selectedTemplate');
    if(!raw) return;
    const t = JSON.parse(raw); localStorage.removeItem('selectedTemplate');
    layers = [];
    if(t.bg){ layers.push({id:uid(), type:'rect', isBg:true, color:t.bg}); }
    if(t.image){ const img = new Image(); img.onload = ()=>{ layers.unshift({id:uid(), type:'image', img, scale: Math.max(canvas.width/img.width, canvas.height/img.height)}); render(); }; img.src = t.image; }
    if(t.text){ layers.push({id:uid(), type:'text', text:t.text, font:'Impact', size:88, color: t.textColor || '#fff', x:80, y:240}); }
    render();
  } catch(e){ console.warn(e) }
})();

// initial
buildTemplates();
render();
</script>
</body>
</html>
